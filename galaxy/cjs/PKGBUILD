# Maintainer: Eli Schwartz <eschwartz@archlinux.org>
# Contributor: Alexandre Filgueira <alexfilgueira@cinnarch.com>
# Contributor: Ionut Biru <ibiru@archlinux.org>

pkgname=cjs
pkgver=128.1
pkgrel=1
pkgdesc="Javascript Bindings for Cinnamon"
arch=('x86_64')
url="https://github.com/linuxmint/${pkgname}"
license=('LGPL-2.0-or-later')
depends=('gobject-introspection-runtime' 'js128' 'readline' 'gcc-libs'
         'libffi' 'cairo' 'glib2' 'libgirepository' 'libx11' 'glibc')
makedepends=('dbus' 'meson' 'gobject-introspection')
checkdepends=('xorg-server-xvfb' 'gtk3')
source=("${pkgname}-${pkgver}.tar.gz::${url}/archive/${pkgver}.tar.gz")
sha512sums=('41aff6bfbd64cec59a64eb49c8913637dd0a482316e6b138f3e3ebef071d2668847f0988d2c6bedd7eec394f538c78683d4c9aacb81f95d198722a0e597611aa')
b2sums=('4b6d0c4d5bb92e8862f0f3ad5703bac5181a68bfc0e3f4167da039d46e4f065d91b49b5345dc97a8b4f991575b6c15a703c36722f4bb47c59b3182263700b18f')

build() {
    artix-meson ${pkgname}-${pkgver} build -D installed_tests=false
    meson compile -C build
}

check() {
    dbus-run-session xvfb-run -s '-nolisten local' \
        meson test -C build --print-errorlogs
}

package() {
    meson install -C build --destdir "${pkgdir}"

    # cjs doesn't properly disable installs from gobject-introspection-tests
    rm -r "${pkgdir}/usr/lib/installed-tests"
}
