# Maintainer: Bruno Pagani <archange@archlinux.org>
# Contributor: Eli Schwartz <eschwartz@archlinux.org>
# Contributor: Alex Filgueira <alexfilgueira (at antergos.com)>
# Contributor: Nate Simon <aurpkg (at natesimon.net)>

pkgname=xapp
pkgver=3.2.2
pkgrel=1
pkgdesc="Common library for X-Apps project"
arch=(x86_64)
url='https://github.com/linuxmint/xapp'
license=('GPL-3.0-only AND LGPL-3.0-only')
depends=(
  bash
  cairo
  dconf
  gcc-libs
  gdk-pixbuf2
  glib2
  glibc
  gtk3
  hicolor-icon-theme
  libdbusmenu-gtk3
  libgnomekbd
  libx11
  libxkbfile
  pango
  python
  python-gobject
  python-setproctitle
  xapp-symbolic-icons
)
makedepends=(
  git
  glib2-devel
  gobject-introspection
  meson
  vala
)
provides=(xapps)
conflicts=(xapps)
replaces=(xapps)
source=("git+https://github.com/linuxmint/xapp.git#tag=$pkgver")
sha256sums=('a13acc0cd27bc82c23b1cf076dde9d27589eef4cb22fa89064c00ab0f6aa87ff')
b2sums=('9ef85da1092ee7b751fd8dd7e9f5ad151a8efb958d3abd0289913f85149ab551675fe29a45f23b15f15ad0fd4b1ede2d72829be1b1ac56f88874ad939cf7b535')

build() {
  artix-meson $pkgname build \
    -D docs=true
  meson compile -C build
}

package(){
  meson install -C build --destdir="$pkgdir"

  # byte-compile python modules since meson does not implement autotoolsâ€™ py-compile.
  local site_packages=$(python -c "import site; print(site.getsitepackages()[0])")
  python -m compileall -o 0 -o 1 -o 2 --hardlink-dupes -s "$pkgdir" "$pkgdir"$site_packages
}
