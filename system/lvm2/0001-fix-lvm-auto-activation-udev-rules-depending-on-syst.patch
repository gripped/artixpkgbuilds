From cdc468a9ec49294a14c7b11b9ea1f87544d0d4b9 Mon Sep 17 00:00:00 2001
From: helican <james-knippes@mailbox.org>
Date: Tue, 17 Oct 2023 15:36:15 +0200
Subject: [PATCH 1/1] fix lvm auto activation udev rules depending on
 systemd-run

---
 0002-udev-rules-systemd-run-fix-auto.patch | 26 ++++++++++++++++++++++
 PKGBUILD                                   |  4 ++++
 2 files changed, 30 insertions(+)
 create mode 100644 0002-udev-rules-systemd-run-fix-auto.patch

diff --git a/0002-udev-rules-systemd-run-fix-auto.patch b/0002-udev-rules-systemd-run-fix-auto.patch
new file mode 100644
index 0000000..6c7152b
--- /dev/null
+++ b/0002-udev-rules-systemd-run-fix-auto.patch
@@ -0,0 +1,26 @@
+From ac4264ea924f2d24f8e6a31aeb3631c8769f454a Mon Sep 17 00:00:00 2001
+From: helican <james-knippes@mailbox.org>
+Date: Tue, 17 Oct 2023 05:08:12 +0200
+Subject: [PATCH 1/1] udev rules: remove systemd(-run) dependency to fix auto
+ activation
+
+---
+ udev/69-dm-lvm.rules.in | 2 +-
+ 1 file changed, 1 insertion(+), 1 deletion(-)
+
+diff --git a/udev/69-dm-lvm.rules.in b/udev/69-dm-lvm.rules.in
+index ff1568145..9f83bfa4b 100644
+--- a/udev/69-dm-lvm.rules.in
++++ b/udev/69-dm-lvm.rules.in
+@@ -76,7 +76,7 @@ LABEL="lvm_scan"
+ # it's better suited to appearing in the journal.
+ 
+ IMPORT{program}="(LVM_EXEC)/lvm pvscan --cache --listvg --checkcomplete --vgonline --autoactivation event --udevoutput --journal=output $env{DEVNAME}"
+-ENV{LVM_VG_NAME_COMPLETE}=="?*", RUN+="(SYSTEMDRUN) --no-block --property DefaultDependencies=no --unit lvm-activate-$env{LVM_VG_NAME_COMPLETE} (LVM_EXEC)/lvm vgchange -aay --autoactivation event $env{LVM_VG_NAME_COMPLETE}"
++ENV{LVM_VG_NAME_COMPLETE}=="?*", RUN+="(LVM_EXEC)/lvm vgchange -aay --autoactivation event $env{LVM_VG_NAME_COMPLETE}"
+ GOTO="lvm_end"
+ 
+ LABEL="lvm_end"
+-- 
+2.42.0
+
-- 
2.42.0

