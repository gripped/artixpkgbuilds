From 03654be2905e2e05e1bf095989f23e9a2fc38726 Mon Sep 17 00:00:00 2001
From: artoo <artoo@artixlinux.org>
Date: Mon, 18 Aug 2025 09:48:38 +0200
Subject: [PATCH 1/1] install sysusers and tmpfiles

---
 data/meson.build  | 18 ++++++++++++++++++
 meson.build       |  3 +++
 meson_options.txt |  4 ++++
 3 files changed, 25 insertions(+)

diff --git a/data/meson.build b/data/meson.build
index d253e7f..2bd9dab 100644
--- a/data/meson.build
+++ b/data/meson.build
@@ -35,6 +35,24 @@ if get_option('systemd')
     install_dir: tmpfilesdir,
   )
 
+  if get_option('daemon_user') != 'root'
+    configure_file(
+      input : 'colord.sysusers.conf.in',
+      output : 'colord-sysusers.conf',
+      configuration : con2,
+      install: true,
+      install_dir: sysusersdir,
+    )
+  endif
+else
+  configure_file(
+    input : 'colord.conf.in',
+    output : 'colord.conf',
+    configuration : con2,
+    install: true,
+    install_dir: tmpfilesdir,
+  )
+
   if get_option('daemon_user') != 'root'
     configure_file(
       input : 'colord.sysusers.conf.in',
diff --git a/meson.build b/meson.build
index 67b4170..7833265 100644
--- a/meson.build
+++ b/meson.build
@@ -142,6 +142,9 @@ if get_option('systemd')
     tmpfilesdir = systemd.get_variable(pkgconfig: 'tmpfilesdir', pkgconfig_define: ['rootprefix', systemd_root_prefix])
     sysusersdir = systemd.get_variable(pkgconfig: 'sysusersdir', pkgconfig_define: ['rootprefix', systemd_root_prefix])
   endif
+else
+    sysusersdir = get_option('sysusersdir')
+    tmpfilesdir = get_option('tmpfilesdir')
 endif
 
 if cc.has_header('pwd.h')
diff --git a/meson_options.txt b/meson_options.txt
index 88d0b7b..411c478 100644
--- a/meson_options.txt
+++ b/meson_options.txt
@@ -16,3 +16,7 @@ option('daemon_user', type : 'string', value : 'root', description : 'User for r
 option('pnp_ids', type : 'string', value : '', description : 'Location of pnp.ids if hwdb is not available')
 option('man', type : 'boolean', value : true, description : 'Generate man pages')
 option('docs', type : 'boolean', value : true, description : 'Generate documentation')
+
+option('sysusersdir', type : 'string', value : '/usr/lib/sysusers.d', description : 'sysusers.d path')
+option('tmpfilesdir', type : 'string', value : '/usr/lib/tmpfiles.d', description : 'tmpfiles.d path')
+
-- 
2.50.1

