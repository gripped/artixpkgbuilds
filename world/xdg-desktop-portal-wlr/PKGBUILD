# Maintainer: Christian Rebischke <chris.rebischke@archlinux.org>
# Maintainer: Carl Smedstad <carsme@archlinux.org>
# Contributor: Maxim Baz <archlinux at maximbaz dot com>
# Contributor: Stefan Tatschner <stefan@rumpelsepp.org>

pkgname=xdg-desktop-portal-wlr
pkgver=0.8.0
pkgrel=1
pkgdesc='xdg-desktop-portal backend for wlroots'
url="https://github.com/emersion/xdg-desktop-portal-wlr"
arch=('x86_64')
license=('MIT')
provides=('xdg-desktop-portal-impl')
depends=(
  'glibc'
  'grim'
  'libdrm'
  'libinih'
  'libpipewire'
  'mesa'
  'pipewire'
  'pipewire-session-manager'
  'slurp'
  'libelogind'
  'wayland'
  'xdg-desktop-portal'
)
makedepends=(
  'meson'
  'scdoc'
  'wayland-protocols'
)
source=(
  "${url}/archive/v${pkgver}/${pkgname}-${pkgver}.tar.gz"
  wlr-portals.conf
)
sha512sums=('41bcfda0a9fc7817201ac0fee04aa0050e0defe9e6108795cee2e279b84d8c63237889150d6cb539d929d93e032fc416fcfe90ff87813ef45bfc2611937fc2b0'
            '71f3383c3f62100dc669c519d107614a4566e808deddf66a179dd2bf175dc272a2390965cf38cd11dc4f0db0dc5cc7104712805034b9bced5874d62b03a579c2')

build() {
  cd "${pkgname}-${pkgver}"
  artix-meson -Dsystemd=disabled -Dsd-bus-provider=libelogind build
  ninja -C build
}

package() {
  cd "${pkgname}-${pkgver}"
  DESTDIR="${pkgdir}" ninja -C build install
  install -vDm644 -t "$pkgdir/usr/share/licenses/${pkgname}" LICENSE

  # fix detection with x-d-p 1.18
  install -vDm644 -t "${pkgdir}/usr/share/xdg-desktop-portal" "${srcdir}/wlr-portals.conf"
}
