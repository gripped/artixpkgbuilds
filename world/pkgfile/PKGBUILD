# Maintainer : Daniel Bermond <dbermond@archlinux.org>
# Contributor: Dave Reisner <d@falconindy.com>

pkgname=pkgfile
pkgver=25
pkgrel=1
pkgdesc='A tool to search for files in official repository packages'
arch=('x86_64')
url='https://github.com/falconindy/pkgfile/'
license=('MIT')
depends=(
    'curl'
    'gcc-libs'
    'glibc'
    'libarchive'
    'libelogind'
    'pacman'
    'pcre'
   )
makedepends=(
    'git'
    'meson')
checkdepends=(
    'gtest'
    'python'
)
install=pkgfile.install
source=("git+https://github.com/falconindy/pkgfile.git#tag=v${pkgver}?signed")
sha256sums=('3b247c9e0647ddf93682b7b9fedee5822004b9b4b57af37be82351f1cdca3b81')
validpgpkeys=('487EACC08557AD082088DABA1EB2638FF56C0C53') # Dave Reisner <d@falconindy.com>

prepare() {
    cd "$pkgname"
    # todo: patch this!
    sed -e 's|libsystemd|libelogind|g' -i meson.build
}

build() {
    artix-meson "$pkgname" -D systemd_units=false build
    meson compile -C build
}

check() {
  meson test -C build --print-errorlogs
}

package() {
    meson install -C build --destdir "$pkgdir"
}
